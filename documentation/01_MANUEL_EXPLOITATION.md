# BlackIA - Manuel d'Exploitation

**Version**: 0.2.0
**Date**: Novembre 2025
**Auteur**: Black Room Technologies
**Statut**: Production Ready (85% complet)

---

## Table des Matières

1. [Vue d'ensemble](#vue-densemble)
2. [Architecture du projet](#architecture-du-projet)
3. [Inventaire des modules](#inventaire-des-modules)
4. [Structure des répertoires](#structure-des-répertoires)
5. [Configuration système](#configuration-système)
6. [Déploiement](#déploiement)
7. [Maintenance](#maintenance)
8. [Dépannage](#dépannage)
9. [Logs et monitoring](#logs-et-monitoring)
10. [Sauvegardes](#sauvegardes)

---

## 1. Vue d'ensemble

### 1.1 Description

**BlackIA** est une suite d'assistance IA complète fonctionnant 100% en local sur macOS avec optimisation Apple Silicon. C'est une application desktop basée sur Electron qui offre des capacités d'IA avancées, d'automatisation de workflows et de gestion documentaire.

### 1.2 Caractéristiques techniques

- **Type**: Application desktop Electron
- **Plateforme**: macOS (arm64, x64, universal)
- **Framework**: Electron 33.2 + React 18.2 + TypeScript 5.3
- **Base de données**: SQLite (via Drizzle ORM)
- **Vector Store**: LanceDB
- **Backend IA**: Ollama + MLX (Python)
- **Licence**: MIT (Open Source avec modules Premium planifiés)

### 1.3 Métriques du projet

- **38,979 lignes de code** (TypeScript/React)
- **152 fichiers TypeScript**
- **82 composants React**
- **11 tables de base de données**
- **35 fichiers de documentation**
- **22 services métier**
- **90+ handlers IPC**

---

## 2. Architecture du projet

### 2.1 Architecture globale

```
┌─────────────────────────────────────────────────────────┐
│                   Application Electron                   │
│                                                           │
│  ┌───────────────────┐         ┌────────────────────┐   │
│  │  Renderer Process │◄───IPC─►│   Main Process     │   │
│  │   (React + TS)    │         │   (Node.js + TS)   │   │
│  └───────────────────┘         └────────────────────┘   │
│                                         │                │
│                                         ▼                │
│                              ┌──────────────────┐        │
│                              │  SQLite Database │        │
│                              └──────────────────┘        │
│                                         │                │
│                                         ▼                │
│                              ┌──────────────────┐        │
│                              │   LanceDB (RAG)  │        │
│                              └──────────────────┘        │
└─────────────────────────────────────────────────────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │  Services Python       │
                    │  - Text RAG            │
                    │  - Vision RAG (Colette)│
                    │  - MLX (Apple Silicon) │
                    └────────────────────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │   Ollama Backend       │
                    │   (Local ou Remote)    │
                    └────────────────────────┘
```

### 2.2 Stack technologique

#### Frontend (Renderer Process)
- **React 18.2** + **TypeScript 5.3**
- **TailwindCSS 3.4** + **shadcn/ui**
- **ReactFlow 11.x** (éditeur de workflow visuel)
- **Zustand 4.x** (gestion d'état)
- **TanStack Query 5.x** (récupération de données)
- **Vite 5.x** (outil de build)

#### Backend (Main Process)
- **Electron 33.2**
- **Node.js 20+** / **TypeScript**
- **Drizzle ORM** + **better-sqlite3**
- **LanceDB** (base de données vectorielle pour RAG)
- **Python 3.11+** (services MLX/IA)

#### Backends IA
- **Ollama** (LLM local & distant)
- **MLX** (optimisé Apple Silicon, via Python)
- **Colette/ColPali** (RAG vision pour documents)
- **Sentence Transformers** (embeddings texte)

---

## 3. Inventaire des modules

### 3.1 Modules principaux (8/10 complets)

| Module | Statut | Chemin | Description |
|--------|--------|--------|-------------|
| **Chat** | ✅ 95% | `/apps/desktop/src/renderer/src/pages/ChatPage.tsx` | Conversations IA avec streaming, dossiers, tags |
| **Workflows** | ✅ 95% | `/apps/desktop/src/main/services/workflow-execution-engine.ts` | Automatisation visuelle avec 7 types de nœuds |
| **Personas** | ✅ 90% | `/apps/desktop/src/main/services/persona-service.ts` | Personnalités IA personnalisables |
| **Prompts** | ✅ 90% | `/apps/desktop/src/main/services/prompt-service.ts` | Bibliothèque de prompts réutilisables |
| **Library/RAG** | ✅ 90% | `/apps/desktop/src/main/services/*-rag-service.ts` | Gestion documentaire avec RAG multi-modal |
| **Documentation** | ✅ 75% | `/apps/desktop/src/main/services/documentation-db-service.ts` | Wiki intégré avec recherche FTS5 |
| **Settings** | ✅ 85% | `/apps/desktop/src/renderer/src/pages/SettingsPage.tsx` | Configuration complète (11 sections) |
| **Editor** | ⚠️ 80% | `/apps/desktop/src/renderer/src/pages/EditorPage.tsx` | Éditeur markdown avec assistance IA |
| **Projects** | ❌ Planifié | - | Gestion de projets code (v1.1) |
| **Logs** | ❌ Planifié | `/apps/desktop/src/main/services/log-service.ts` | Système de logs avancé (v1.1) |

### 3.2 Services métier (22 services)

#### Services principaux
| Service | Fichier | Lignes | Description |
|---------|---------|--------|-------------|
| **Backend Manager** | `backend-manager.ts` | 350 | Orchestration des backends IA |
| **Workflow Engine** | `workflow-execution-engine.ts` | 545 | Moteur d'exécution de workflows |
| **Workflow Context** | `workflow-execution-context.ts` | 320 | État d'exécution runtime |
| **Persona Service** | `persona-service.ts` | 280 | CRUD personas, recherche, catégories |
| **Prompt Service** | `prompt-service.ts` | 250 | Gestion de templates de prompts |

#### Services RAG
| Service | Fichier | Lignes | Description |
|---------|---------|--------|-------------|
| **Text RAG v1** | `text-rag-service.ts` | 420 | RAG texte avec Ollama |
| **Text RAG v2** | `text-rag-service-v2.ts` | 380 | Version améliorée |
| **Vision RAG** | `vision-rag-service.ts` | 450 | RAG vision pour documents |
| **Colette RAG** | `colette-vision-rag-service.ts` | 520 | Integration ColPali (JoliBrain) |
| **Hybrid RAG** | `hybrid-rag-service.ts` | 380 | Fusion texte + vision |
| **Vector Store** | `vector-store.ts` | 290 | Wrapper LanceDB |

#### Services documents
| Service | Fichier | Lignes | Description |
|---------|---------|--------|-------------|
| **Attachment Service** | `attachment-service.ts` | 480 | Upload et indexation de fichiers |
| **Library Service** | `library-service.ts` | 360 | Gestion de collections |
| **Library Document** | `library-document-service.ts` | 420 | CRUD documents |
| **Chunk Editor** | `chunk-editor-service.ts` | 340 | Édition manuelle de chunks |
| **Text Extraction** | `text-extraction-service.ts` | 180 | Extraction de texte PDF |
| **Thumbnail** | `thumbnail-service.ts` | 150 | Génération d'images |

#### Services utilitaires
| Service | Fichier | Lignes | Description |
|---------|---------|--------|-------------|
| **Log Service** | `log-service.ts` | 220 | Logging centralisé |
| **Documentation DB** | `documentation-db-service.ts` | 280 | Gestion du wiki |
| **Persona Suggestion** | `persona-suggestion-service.ts` | 190 | Auto-suggestions |
| **Tag Sync** | `tag-sync-service.ts` | 160 | Synchronisation de tags |
| **Workflow DB** | `workflow-db-service.ts` | 380 | Templates, versions, variables |

---

## 4. Structure des répertoires

### 4.1 Structure complète

```
/home/user/BlackIA/
│
├── apps/
│   └── desktop/                          # Application Electron principale
│       ├── src/
│       │   ├── main/                     # Main process (Node.js)
│       │   │   ├── database/             # SQLite + Drizzle ORM
│       │   │   │   ├── schema.ts         # Définition de 11 tables
│       │   │   │   ├── client.ts         # Connexion DB
│       │   │   │   └── migrations/       # 5 fichiers de migration
│       │   │   ├── handlers/             # IPC handlers (13 fichiers)
│       │   │   │   ├── persona-handlers.ts
│       │   │   │   ├── prompt-handlers.ts
│       │   │   │   ├── workflow-handlers.ts
│       │   │   │   ├── chat-handlers.ts
│       │   │   │   ├── rag-handlers.ts
│       │   │   │   ├── library-handlers.ts
│       │   │   │   ├── attachment-handlers.ts
│       │   │   │   ├── documentation-handlers.ts
│       │   │   │   ├── log-handlers.ts
│       │   │   │   ├── settings-handlers.ts
│       │   │   │   ├── folder-handlers.ts
│       │   │   │   ├── tag-handlers.ts
│       │   │   │   └── backend-handlers.ts
│       │   │   ├── services/             # Logique métier (22 services)
│       │   │   │   ├── backends/
│       │   │   │   │   ├── mlx/
│       │   │   │   │   │   ├── mlx-service.ts
│       │   │   │   │   │   └── mlx-embeddings.ts
│       │   │   │   │   └── ollama/
│       │   │   │   │       └── ollama-embedded-service.ts
│       │   │   │   ├── persona-service.ts
│       │   │   │   ├── prompt-service.ts
│       │   │   │   ├── workflow-service.ts
│       │   │   │   ├── workflow-db-service.ts
│       │   │   │   ├── workflow-execution-engine.ts
│       │   │   │   ├── workflow-execution-context.ts
│       │   │   │   ├── text-rag-service.ts
│       │   │   │   ├── text-rag-service-v2.ts
│       │   │   │   ├── vision-rag-service.ts
│       │   │   │   ├── colette-vision-rag-service.ts
│       │   │   │   ├── hybrid-rag-service.ts
│       │   │   │   ├── vector-store.ts
│       │   │   │   ├── attachment-service.ts
│       │   │   │   ├── library-service.ts
│       │   │   │   ├── library-document-service.ts
│       │   │   │   ├── chunk-editor-service.ts
│       │   │   │   ├── text-extraction-service.ts
│       │   │   │   ├── thumbnail-service.ts
│       │   │   │   ├── log-service.ts
│       │   │   │   ├── documentation-db-service.ts
│       │   │   │   ├── persona-suggestion-service.ts
│       │   │   │   ├── tag-sync-service.ts
│       │   │   │   └── backend-manager.ts
│       │   │   ├── types/                # Types TypeScript
│       │   │   │   ├── workflow.ts
│       │   │   │   ├── rag.ts
│       │   │   │   ├── backend.ts
│       │   │   │   └── index.ts
│       │   │   └── index.ts              # Point d'entrée principal
│       │   ├── renderer/                 # Frontend React
│       │   │   └── src/
│       │   │       ├── components/       # 82 composants React
│       │   │       │   ├── chat/         # 22 composants chat
│       │   │       │   ├── workflows/    # 14+ composants workflow
│       │   │       │   ├── personas/     # 8 composants persona
│       │   │       │   ├── prompts/      # 6 composants prompt
│       │   │       │   ├── library/      # 12 composants bibliothèque
│       │   │       │   ├── attachments/  # 8 composants pièces jointes
│       │   │       │   ├── settings/     # 11 composants paramètres
│       │   │       │   └── ui/           # Composants shadcn/ui
│       │   │       ├── pages/            # 11 pages
│       │   │       │   ├── ChatPage.tsx
│       │   │       │   ├── WorkflowsPage.tsx
│       │   │       │   ├── PersonasPage.tsx
│       │   │       │   ├── PromptsPage.tsx
│       │   │       │   ├── LibraryPage.tsx
│       │   │       │   ├── DocumentationPage.tsx
│       │   │       │   ├── SettingsPage.tsx
│       │   │       │   ├── EditorPage.tsx
│       │   │       │   ├── ProjectsPage.tsx (planifié)
│       │   │       │   ├── LogsPage.tsx (planifié)
│       │   │       │   └── NotFoundPage.tsx
│       │   │       ├── contexts/         # Contextes React
│       │   │       │   ├── ThemeContext.tsx
│       │   │       │   ├── BackendContext.tsx
│       │   │       │   └── SettingsContext.tsx
│       │   │       ├── hooks/            # 12 hooks personnalisés
│       │   │       │   ├── usePersonas.ts
│       │   │       │   ├── usePrompts.ts
│       │   │       │   ├── useWorkflows.ts
│       │   │       │   ├── useChat.ts
│       │   │       │   ├── useBackend.ts
│       │   │       │   └── ...
│       │   │       ├── utils/
│       │   │       │   ├── ipc.ts
│       │   │       │   ├── format.ts
│       │   │       │   └── validation.ts
│       │   │       ├── App.tsx
│       │   │       └── main.tsx
│       │   ├── python/                   # Services Python
│       │   │   ├── text_rag/            # RAG texte avec Ollama
│       │   │   │   ├── embed.py
│       │   │   │   └── requirements.txt
│       │   │   ├── vision_rag/          # RAG vision avec Colette
│       │   │   │   ├── colette_embedder.py        # 282 lignes
│       │   │   │   ├── mlx_vision_embedder.py     # Support MLX-VLM
│       │   │   │   ├── late_interaction.py        # Scoring MaxSim
│       │   │   │   ├── document_processor.py      # Traitement PDF
│       │   │   │   └── requirements.txt
│       │   │   └── requirements.txt      # Dépendances globales
│       │   ├── preload/                 # Scripts preload
│       │   │   └── index.ts
│       │   └── resources/               # Ressources (icônes, etc.)
│       ├── package.json
│       ├── tsconfig.json
│       ├── tsconfig.main.json
│       ├── vite.config.ts
│       ├── tailwind.config.js
│       ├── electron-builder.yml         # Configuration build
│       └── drizzle.config.ts            # Configuration Drizzle ORM
│
├── packages/                            # Packages workspace partagés
│   ├── ollama/                         # Client Ollama (0 dépendances)
│   │   ├── src/
│   │   │   ├── client.ts               # API Ollama complète
│   │   │   ├── types.ts                # Types TypeScript
│   │   │   └── errors.ts               # Gestion d'erreurs
│   │   ├── package.json
│   │   └── tsconfig.json
│   ├── shared/                         # Types et utils partagés
│   │   ├── src/
│   │   │   └── types/
│   │   │       └── index.ts            # 395 lignes de types
│   │   ├── package.json
│   │   └── tsconfig.json
│   └── ui/                             # Composants UI partagés
│       ├── src/
│       ├── package.json
│       └── tsconfig.json
│
├── scripts/                            # Scripts de build et dev
│   ├── dev.sh                          # Script de développement
│   ├── build-dmg.sh                    # Build DMG production
│   ├── verify-setup.sh                 # Vérification installation
│   ├── setup-python-venv.sh            # Setup environnement Python
│   ├── generate-icons.sh               # Génération d'icônes
│   ├── clean-reinstall.sh              # Nettoyage complet
│   └── README.md
│
├── docs/                               # Documentation (35 fichiers markdown)
│   ├── README.md
│   ├── CAHIER_DES_CHARGES.md
│   ├── DECISIONS_TECHNIQUES.md         # 794 lignes
│   ├── PROJECT_STATUS.md               # 200 lignes
│   ├── MODULE_BIBLIOTHEQUE_DOCUMENTS.md
│   ├── DEVELOPMENT.md
│   ├── BETA_TEST_GUIDE.md
│   └── ...
│
├── package.json                        # Package root
├── pnpm-workspace.yaml                 # Configuration workspace
├── turbo.json                          # Configuration Turborepo
├── tsconfig.json                       # Config TypeScript globale
├── .eslintrc.json                      # Configuration ESLint
├── .prettierrc                         # Configuration Prettier
├── .gitignore
├── LICENSE                             # Licence MIT
└── README.md
```

### 4.2 Répertoires de données

**Emplacement des données utilisateur** (macOS):

```
~/Library/Application Support/BlackIA/
├── database/
│   └── blackia.db                      # Base de données SQLite principale
├── vector-store/                       # Données LanceDB (vecteurs RAG)
│   ├── text_embeddings/
│   └── vision_embeddings/
├── libraries/                          # Documents utilisateur
│   └── [library-id]/
│       ├── documents/
│       └── thumbnails/
├── logs/                               # Logs applicatifs
│   ├── main.log
│   ├── renderer.log
│   └── python.log
└── cache/                              # Cache temporaire
```

---

## 5. Configuration système

### 5.1 Prérequis

#### Système d'exploitation
- **macOS 11.0** (Big Sur) ou supérieur
- Recommandé: **macOS 14.0** (Sonoma) ou **macOS 15.0** (Sequoia)
- Architecture: **arm64** (Apple Silicon) ou **x64** (Intel)

#### Matériel recommandé
- **CPU**: Apple Silicon (M1/M2/M3/M4) recommandé pour MLX
- **RAM**: 16 GB minimum, 32 GB recommandé
- **Stockage**: 5 GB pour l'application + espace pour données utilisateur
- **GPU**: Metal supporté (pour MLX et acceleration IA)

#### Logiciels requis (développement)
- **Node.js**: ≥ 20.0.0
- **pnpm**: ≥ 8.0.0
- **Python**: ≥ 3.11 (pour services RAG)
- **Git**: Pour le contrôle de version

#### Backends IA (optionnels)
- **Ollama**: Pour LLM local (recommandé)
- **Poppler**: Pour conversion PDF (pdf2image)

### 5.2 Fichiers de configuration

#### electron-builder.yml
```yaml
appId: com.blackroom.blackia
productName: BlackIA
directories:
  output: release
  buildResources: resources
mac:
  category: public.app-category.productivity
  icon: resources/icon.icns
  target:
    - target: dmg
      arch: [arm64, x64, universal]
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: resources/entitlements.mac.plist
  entitlementsInherit: resources/entitlements.mac.plist
```

#### drizzle.config.ts
```typescript
import type { Config } from 'drizzle-kit';

export default {
  schema: './src/main/database/schema.ts',
  out: './src/main/database/migrations',
  driver: 'better-sqlite3',
  dbCredentials: {
    url: './database/blackia.db'
  }
} satisfies Config;
```

#### vite.config.ts
```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  base: './',
  build: {
    outDir: 'dist/renderer',
    emptyOutDir: true,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src/renderer/src'),
    },
  },
  server: {
    port: 5173,
  },
});
```

### 5.3 Variables d'environnement

```bash
# Développement
NODE_ENV=development
ELECTRON_DISABLE_SECURITY_WARNINGS=true

# Production
NODE_ENV=production

# Python
PYTHONPATH=/path/to/BlackIA/apps/desktop/src/python

# Ollama
OLLAMA_HOST=http://localhost:11434

# MLX (Apple Silicon)
PYTORCH_ENABLE_MPS_FALLBACK=1
```

---

## 6. Déploiement

### 6.1 Build de développement

```bash
# À la racine du projet
cd /path/to/BlackIA

# Installation des dépendances
pnpm install

# Vérification de l'installation
pnpm verify

# Lancement en mode développement
pnpm desktop:dev
```

### 6.2 Build de production

#### Build DMG standard (arm64)
```bash
# Build DMG pour Apple Silicon
pnpm build:dmg

# Résultat dans apps/desktop/release/*.dmg
```

#### Build avec options avancées
```bash
# Build avec nettoyage préalable
./scripts/build-dmg.sh --clean

# Build universal (arm64 + x64)
./scripts/build-dmg.sh --arch universal

# Build avec signature code (nécessite certificat Apple)
./scripts/build-dmg.sh --sign
```

#### Build pour différentes architectures
```bash
# Arm64 (Apple Silicon) - défaut
pnpm build:dmg:arm64

# x64 (Intel)
pnpm build:dmg:x64

# Universal (les deux)
pnpm build:dmg:universal
```

### 6.3 Distribution

#### Fichiers générés
```
apps/desktop/release/
├── BlackIA-0.2.0-arm64.dmg          # Version Apple Silicon
├── BlackIA-0.2.0-x64.dmg            # Version Intel
└── BlackIA-0.2.0-universal.dmg      # Version universelle
```

#### Installation utilisateur final
1. Double-cliquer sur le fichier `.dmg`
2. Glisser-déposer `BlackIA.app` dans `/Applications`
3. Autoriser l'application dans **Préférences Système > Confidentialité et sécurité** (si non signé)
4. Lancer depuis `/Applications/BlackIA.app`

### 6.4 Signature et notarisation (production)

```bash
# 1. Obtenir un certificat Developer ID Application
# Apple Developer Program requis

# 2. Build avec signature
export CSC_IDENTITY_AUTO_DISCOVERY=true
export CSC_NAME="Developer ID Application: Your Name (TEAM_ID)"
./scripts/build-dmg.sh --sign

# 3. Notarisation (après signature)
xcrun notarytool submit BlackIA-0.2.0.dmg \
  --apple-id "your@email.com" \
  --password "app-specific-password" \
  --team-id "TEAM_ID" \
  --wait

# 4. Stapler la notarisation
xcrun stapler staple BlackIA-0.2.0.dmg
```

---

## 7. Maintenance

### 7.1 Mises à jour des dépendances

```bash
# Vérifier les dépendances obsolètes
pnpm outdated

# Mettre à jour les dépendances mineures
pnpm update

# Mettre à jour les dépendances majeures (avec précaution)
pnpm update --latest

# Mettre à jour pnpm lui-même
npm install -g pnpm@latest
```

### 7.2 Migrations de base de données

```bash
# Générer une nouvelle migration (après modification de schema.ts)
cd apps/desktop
pnpm exec drizzle-kit generate:sqlite

# Appliquer les migrations
# Les migrations sont appliquées automatiquement au démarrage de l'app
```

### 7.3 Nettoyage

```bash
# Nettoyage complet (node_modules + builds)
pnpm clean

# Nettoyage des builds seulement
pnpm clean:build

# Nettoyage avec réinstallation
./scripts/clean-reinstall.sh
```

### 7.4 Tests

```bash
# Tests unitaires
pnpm test

# Tests avec couverture
pnpm test:coverage

# Tests avec interface UI
pnpm test:ui

# Tests en mode watch
pnpm test:watch
```

### 7.5 Linting et formatting

```bash
# ESLint
pnpm lint

# Prettier
pnpm format

# Type checking
pnpm type-check
```

---

## 8. Dépannage

### 8.1 Problèmes courants

#### L'application ne démarre pas

**Symptômes**: Crash au lancement, écran noir

**Solutions**:
```bash
# 1. Vérifier les logs
tail -f ~/Library/Application\ Support/BlackIA/logs/main.log

# 2. Réinitialiser la base de données
rm ~/Library/Application\ Support/BlackIA/database/blackia.db
# L'app recréera la DB au prochain démarrage

# 3. Réinstaller les dépendances
pnpm clean && pnpm install
```

#### Erreur "better-sqlite3 not found"

**Symptômes**: Erreur au démarrage sur module SQLite

**Solutions**:
```bash
# Rebuild de better-sqlite3
cd apps/desktop
pnpm exec electron-rebuild -f -w better-sqlite3

# Ou utiliser le script postinstall
pnpm postinstall
```

#### Python service ne démarre pas

**Symptômes**: Erreurs RAG, embeddings ne fonctionnent pas

**Solutions**:
```bash
# 1. Vérifier l'installation Python
python3 --version  # Doit être ≥ 3.11

# 2. Réinstaller les dépendances Python
cd apps/desktop/src/python
python3 -m pip install -r requirements.txt --upgrade

# 3. Vérifier les logs Python
tail -f ~/Library/Application\ Support/BlackIA/logs/python.log
```

#### Ollama non détecté

**Symptômes**: Backend Ollama unavailable

**Solutions**:
```bash
# 1. Vérifier qu'Ollama est installé et lancé
ollama list

# 2. Vérifier le port
curl http://localhost:11434/api/tags

# 3. Configurer l'URL dans Settings > AI Local
# Par défaut: http://localhost:11434
```

#### Build DMG échoue

**Symptômes**: Erreur pendant `electron-builder`

**Solutions**:
```bash
# 1. Nettoyer et rebuilder
./scripts/build-dmg.sh --clean

# 2. Vérifier les permissions
chmod -R 755 apps/desktop/dist
chmod -R 755 apps/desktop/release

# 3. Désactiver la signature pour test
export CSC_IDENTITY_AUTO_DISCOVERY=false
./scripts/build-dmg.sh
```

### 8.2 Commandes de diagnostic

```bash
# Vérifier la santé du projet
pnpm verify

# Afficher les processus Electron
ps aux | grep -i electron

# Afficher les processus Python
ps aux | grep -i python

# Vérifier les ports utilisés
lsof -i :5173  # Vite dev server
lsof -i :11434 # Ollama

# Taille de la base de données
du -h ~/Library/Application\ Support/BlackIA/database/blackia.db

# Taille du vector store
du -sh ~/Library/Application\ Support/BlackIA/vector-store/
```

---

## 9. Logs et monitoring

### 9.1 Emplacements des logs

```
~/Library/Application Support/BlackIA/logs/
├── main.log           # Logs du main process (Node.js)
├── renderer.log       # Logs du renderer process (React)
├── python.log         # Logs des services Python
└── error.log          # Erreurs critiques uniquement
```

### 9.2 Niveaux de log

| Niveau | Description | Exemple |
|--------|-------------|---------|
| `ERROR` | Erreurs critiques | Échec de connexion DB |
| `WARN` | Avertissements | Modèle Ollama non trouvé |
| `INFO` | Informations | Démarrage de l'app |
| `DEBUG` | Débogage détaillé | Requêtes SQL |

### 9.3 Consultation des logs

```bash
# Logs en temps réel
tail -f ~/Library/Application\ Support/BlackIA/logs/main.log

# Logs avec coloration (si installé)
tail -f ~/Library/Application\ Support/BlackIA/logs/main.log | grep --color ERROR

# Recherche d'erreurs
grep -r "ERROR" ~/Library/Application\ Support/BlackIA/logs/

# Dernières 100 lignes
tail -100 ~/Library/Application\ Support/BlackIA/logs/main.log
```

### 9.4 Activation du mode debug

**Dans le code** (`apps/desktop/src/main/index.ts`):
```typescript
const LOG_LEVEL = process.env.NODE_ENV === 'development' ? 'DEBUG' : 'INFO';
```

**Via variable d'environnement**:
```bash
export LOG_LEVEL=DEBUG
pnpm desktop:dev
```

---

## 10. Sauvegardes

### 10.1 Fichiers à sauvegarder

```
~/Library/Application Support/BlackIA/
├── database/blackia.db              # Base de données principale (CRITIQUE)
├── vector-store/                    # Embeddings RAG (IMPORTANT)
├── libraries/                       # Documents utilisateur (CRITIQUE)
└── settings.json                    # Configuration (IMPORTANT)
```

### 10.2 Script de sauvegarde automatique

```bash
#!/bin/bash
# backup-blackia.sh

BACKUP_DIR="$HOME/Backups/BlackIA"
DATA_DIR="$HOME/Library/Application Support/BlackIA"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

mkdir -p "$BACKUP_DIR"

# Sauvegarde complète
tar -czf "$BACKUP_DIR/blackia_backup_$TIMESTAMP.tar.gz" \
  "$DATA_DIR/database" \
  "$DATA_DIR/libraries" \
  "$DATA_DIR/vector-store"

echo "✅ Sauvegarde créée: blackia_backup_$TIMESTAMP.tar.gz"

# Garder seulement les 7 dernières sauvegardes
cd "$BACKUP_DIR"
ls -t blackia_backup_*.tar.gz | tail -n +8 | xargs rm -f
```

### 10.3 Restauration

```bash
#!/bin/bash
# restore-blackia.sh

BACKUP_FILE="$1"
DATA_DIR="$HOME/Library/Application Support/BlackIA"

if [ -z "$BACKUP_FILE" ]; then
  echo "❌ Usage: ./restore-blackia.sh <fichier_backup.tar.gz>"
  exit 1
fi

# Arrêter l'application d'abord
echo "⚠️  Assurez-vous que BlackIA est fermée avant de continuer"
read -p "Continuer? (o/N) " -n 1 -r
echo

if [[ ! $REPLY =~ ^[Oo]$ ]]; then
  exit 1
fi

# Sauvegarde de sécurité
tar -czf "$HOME/blackia_preRestore_$(date +%Y%m%d_%H%M%S).tar.gz" "$DATA_DIR"

# Restauration
tar -xzf "$BACKUP_FILE" -C "$HOME/Library/Application Support/"

echo "✅ Restauration terminée"
```

### 10.4 Export/Import des données utilisateur

**Export via l'interface**:
1. Ouvrir BlackIA
2. Aller dans **Settings > Data Management**
3. Cliquer sur **Export All Data**
4. Choisir l'emplacement de sauvegarde

**Import via l'interface**:
1. Ouvrir BlackIA
2. Aller dans **Settings > Data Management**
3. Cliquer sur **Import Data**
4. Sélectionner le fichier `.blackia-backup`

---

## 11. Support et ressources

### 11.1 Documentation

- **Documentation projet**: `/docs/` dans le dépôt Git
- **Wiki intégré**: Accessible dans l'application (module Documentation)
- **API Documentation**: Générer avec `pnpm docs:generate`

### 11.2 Contacts

- **Développeur**: Black Room Technologies
- **License**: MIT (Open Source)
- **Repository**: https://github.com/[votre-org]/BlackIA (à mettre à jour)

### 11.3 Commandes rapides

```bash
# Aide des scripts
./scripts/dev.sh --help
./scripts/build-dmg.sh --help

# Vérification complète
pnpm verify

# État du projet
cat docs/PROJECT_STATUS.md

# Version installée
cat package.json | grep version
```

---

## Annexes

### A. Architecture détaillée
Voir `documentation/03_ARCHITECTURE_DETAILLEE.md`

### B. Guide développeur
Voir `documentation/02_MANUEL_CODEUR.md`

### C. Guide utilisateur
Voir `documentation/03_MANUEL_UTILISATEUR.md`

### D. Manuel d'installation
Voir `documentation/04_MANUEL_INSTALLATION.md`

---

**Fin du Manuel d'Exploitation**

*Dernière mise à jour: Novembre 2025*
*Version du document: 1.0*
